{# This Source Code Form is subject to the terms of the Mozilla Public
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/. #}

{% macro email_newsletter_form(newsletter_id='mozilla-and-you', title=None, include_country=True, include_language=True, footer=True) %}
  {% if not request.newsletter_success %}
    {% if request.newsletter_form.errors %}
      <div id="footer-email-errors">
        {{ request.newsletter_form.non_field_errors()|safe }}

        <ul class="errorlist">
            {% if request.newsletter_form.email.errors %}
                <li>{{ _('Please enter a valid email address') }}</li>
            {% endif %}

            {% if request.newsletter_form.lang.errors %}
                <li>{{ request.newsletter_form.lang.errors }}</li>
            {% endif %}

            {% if request.newsletter_form.newsletter.errors %}
                <li>{{ request.newsletter_form.newsletter.errors }}</li>
            {% endif %}

            {% if request.newsletter_form.privacy.errors %}
                <li>{{ _('You must agree to the privacy policy') }}</li>
            {% endif %}
        </ul>
      </div>
    {% endif %}

    <form class="billboard newsletter-form{% if request.newsletter_form.errors %} has-errors{% endif %}"
          {% if footer %}
             id="footer-email-form" action="{{ secure_url() }}#footer-email-form"
          {% else %}
              id="newsletter-form" action="{{ secure_url() }}"
          {% endif %}
          method="post">
      {% if footer %}
        <input type="hidden" name="newsletter-footer" value="Y">
      {% endif %}
      <input type="hidden" name="newsletter" value="{{ newsletter_id }}">
      <input type="hidden" name="source_url" value="{{ request.build_absolute_uri() }}">

      {% if footer %}
        <h3>{{ title|d(_('Get Firefox news'), true) }}</h3>
      {% endif %}

      <div class="form-contents">
        <div class="field field-email {% if request.newsletter_form.email.errors %}form-field-error{% endif %}">
          {{ field_with_attrs(request.newsletter_form.email, placeholder=_('YOUR EMAIL HERE'))|safe }}
        </div>

        <div id="form-details">
          {% if include_country %}
            <div class="field field-country">
              {{ request.newsletter_form.country|safe }}
            </div>
          {% endif %}
          {% if include_language %}
            <div class="field field-language {% if request.newsletter_form.lang.errors %}form-field-error{% endif %}">
              {{ request.newsletter_form.lang|safe }}
            </div>
          {% endif %}
          <div class="field field-format">
            {{ request.newsletter_form.fmt|safe }}
          </div>
          <div class="field field-privacy {% if request.newsletter_form.privacy.errors %}form-field-error{% endif %}">
            {{ request.newsletter_form.privacy|safe }}
          </div>
        </div>
      </div>

      <div class="form-submit">
        <input type="submit" id="footer_email_submit"
               value="{{ _('Sign me up') }} »" class="button">

        <p class="form-details">
          <small>{{ _('We will only send you Mozilla-related information.') }}</small>
        </p>
      </div>
    </form>
  {% else %}
    <div id="footer-email-form" class="thank billboard">
      <h3>{{ _('Thanks! Please check your inbox to confirm your subscription.') }}</h3>
        <p>
          {% trans %}
            You'll receive an email from mozilla@e.mozilla.org to confirm your subscription.
            If you don't see it, check your spam filter. You must confirm your subscription to receive our newsletter.
          {% endtrans %}
        </p>
    </div>
  {% endif %}
{% endmacro %}

{% macro mozorg_newsletter_form() %}
  {% add_lang_files "geography" %}
  {# Note: This form differs from the email_newsletter_form() that appears on most pages;
    The global form submits to bedrock, this one submits to sendto.mozilla.org #}
<aside class="billboard newsletter-form">
  <form id="footer-email-form" method="post" action="https://sendto.mozilla.org/page/s/sign-up-for-mozilla">
    <h3>{{ _('Get Mozilla updates') }} - {{ dump_country()|safe }}</h3>

    <div class="form-contents">
      <div class="field field-email">
        <label for="id_email" class="hidden">{{ _('Email') }}</label>
        <input name="email" type="email" id="id_email" value="" required aria-required="true" placeholder="{{ _('YOUR EMAIL HERE') }}">
      </div>

      <div id="form-details">
        <!-- This is bad, but a quick fix because we are pushing live in an hour -->
        <div class="field field-country">
          <label for="country" class="hidden">{{ _('Country') }}</label>
          <select id="country" name="country">
            <option value=""></option>
            <option value="AF">{{ _('Afghanistan') }}</option>
            <option value="AL">{{ _('Albania') }}</option>
            <option value="DZ">{{ _('Algeria') }}</option>
            <option value="AS">{{ _('American Samoa') }}</option>
            <option value="AD">{{ _('Andorra') }}</option>
            <option value="AO">{{ _('Angola') }}</option>
            <option value="AI">{{ _('Anguilla') }}</option>
            <option value="AG">{{ _('Antigua and Barbuda') }}</option>
            <option value="AR">{{ _('Argentina') }}</option>
            <option value="AM">{{ _('Armenia') }}</option>
            <option value="AW">{{ _('Aruba') }}</option>
            <option value="AU">{{ _('Australia') }}</option>
            <option value="AT">{{ _('Austria') }}</option>
            <option value="AZ">{{ _('Azerbaijan') }}</option>
            <option value="BS">{{ _('Bahamas') }}</option>
            <option value="BH">{{ _('Bahrain') }}</option>
            <option value="BD">{{ _('Bangladesh') }}</option>
            <option value="BB">{{ _('Barbados') }}</option>
            <option value="BY">{{ _('Belarus') }}</option>
            <option value="BE">{{ _('Belgium') }}</option>
            <option value="BZ">{{ _('Belize') }}</option>
            <option value="BJ">{{ _('Benin') }}</option>
            <option value="BM">{{ _('Bermuda') }}</option>
            <option value="BT">{{ _('Bhutan') }}</option>
            <option value="BO">{{ _('Bolivia') }}</option>
            <option value="BA">{{ _('Bosnia and Herzegovina') }}</option>
            <option value="BW">{{ _('Botswana') }}</option>
            <option value="BR">{{ _('Brazil') }}</option>
            <option value="VG">{{ _('British Virgin Islands') }}</option>
            <option value="IO">{{ _('British Indian Ocean Territory') }}</option>
            <option value="BN">{{ _('Brunei') }}</option>
            <option value="BG">{{ _('Bulgaria') }}</option>
            <option value="BF">{{ _('Burkina Faso') }}</option>
            <option value="BI">{{ _('Burundi') }}</option>
            <option value="KH">{{ _('Cambodia') }}</option>
            <option value="CM">{{ _('Cameroon') }}</option>
            <option value="CA">{{ _('Canada') }}</option>
            <option value="CV">{{ _('Cape Verde') }}</option>
            <option value="KY">{{ _('Cayman Islands') }}</option>
            <option value="CF">{{ _('Central African Republic') }}</option>
            <option value="TD">{{ _('Chad') }}</option>
            <option value="CL">{{ _('Chile') }}</option>
            <option value="CN">{{ _('China') }}</option>
            <option value="CX">{{ _('Christmas Island') }}</option>
            <option value="CO">{{ _('Colombia') }}</option>
            <option value="KM">{{ _('Comoros Islands') }}</option>
            <option value="CD">{{ _('Congo, Democratic Republic of the') }}</option>
            <option value="CG">{{ _('Congo, Republic of the') }}</option>
            <option value="CK">{{ _('Cook Islands') }}</option>
            <option value="CR">{{ _('Costa Rica') }}</option>
            <option value="CI">{{ _('Cote D\'ivoire') }}</option>
            <option value="HR">{{ _('Croatia') }}</option>
            <option value="CU">{{ _('Cuba') }}</option>
            <option value="CY">{{ _('Cyprus') }}</option>
            <option value="CZ">{{ _('Czech Republic') }}</option>
            <option value="DK">{{ _('Denmark') }}</option>
            <option value="DJ">{{ _('Djibouti') }}</option>
            <option value="DM">{{ _('Dominica') }}</option>
            <option value="DO">{{ _('Dominican Republic') }}</option>
            <option value="TP">{{ _('East Timor') }}</option>
            <option value="EC">{{ _('Ecuador') }}</option>
            <option value="EG">{{ _('Egypt') }}</option>
            <option value="SV">{{ _('El Salvador') }}</option>
            <option value="GQ">{{ _('Equatorial Guinea') }}</option>
            <option value="ER">{{ _('Eritrea') }}</option>
            <option value="EE">{{ _('Estonia') }}</option>
            <option value="ET">{{ _('Ethiopia') }}</option>
            <option value="FK">{{ _('Falkland Islands (Malvinas)') }}</option>
            <option value="FO">{{ _('Faroe Islands') }}</option>
            <option value="FJ">{{ _('Fiji') }}</option>
            <option value="FI">{{ _('Finland') }}</option>
            <option value="FR">{{ _('France') }}</option>
            <option value="GF">{{ _('French Guiana') }}</option>
            <option value="PF">{{ _('French Polynesia') }}</option>
            <option value="TF">{{ _('French Southern Territories') }}</option>
            <option value="GA">{{ _('Gabon') }}</option>
            <option value="GM">{{ _('Gambia') }}</option>
            <option value="GE">{{ _('Georgia') }}</option>
            <option value="DE">{{ _('Germany') }}</option>
            <option value="GH">{{ _('Ghana') }}</option>
            <option value="GI">{{ _('Gibraltar') }}</option>
            <option value="GR">{{ _('Greece') }}</option>
            <option value="GL">{{ _('Greenland') }}</option>
            <option value="GD">{{ _('Grenada') }}</option>
            <option value="GP">{{ _('Guadeloupe') }}</option>
            <option value="GU">{{ _('Guam') }}</option>
            <option value="GT">{{ _('Guatemala') }}</option>
            <option value="GN">{{ _('Guinea') }}</option>
            <option value="GW">{{ _('Guinea-Bissau') }}</option>
            <option value="GY">{{ _('Guyana') }}</option>
            <option value="HT">{{ _('Haiti') }}</option>
            <option value="VA">{{ _('Holy See (Vatican City State)') }}</option>
            <option value="HN">{{ _('Honduras') }}</option>
            <option value="HK">{{ _('Hong Kong') }}</option>
            <option value="HU">{{ _('Hungary') }}</option>
            <option value="IS">{{ _('Iceland') }}</option>
            <option value="IN">{{ _('India') }}</option>
            <option value="ID">{{ _('Indonesia') }}</option>
            <option value="IR">{{ _('Iran') }}</option>
            <option value="IQ">{{ _('Iraq') }}</option>
            <option value="IE">{{ _('Ireland') }}</option>
            <option value="IL">{{ _('Israel') }}</option>
            <option value="IT">{{ _('Italy') }}</option>
            <option value="JM">{{ _('Jamaica') }}</option>
            <option value="JP">{{ _('Japan') }}</option>
            <option value="JO">{{ _('Jordan') }}</option>
            <option value="KZ">{{ _('Kazakhstan') }}</option>
            <option value="KE">{{ _('Kenya') }}</option>
            <option value="KI">{{ _('Kiribati') }}</option>
            <option value="KR">{{ _('South Korea') }}</option>
            <option value="XK">{{ _('Kosovo') }}</option>
            <option value="KW">{{ _('Kuwait') }}</option>
            <option value="KG">{{ _('Kyrgyzstan') }}</option>
            <option value="LA">{{ _('Laos') }}</option>
            <option value="LV">{{ _('Latvia') }}</option>
            <option value="LB">{{ _('Lebanon') }}</option>
            <option value="LS">{{ _('Lesotho') }}</option>
            <option value="LR">{{ _('Liberia') }}</option>
            <option value="LI">{{ _('Liechtenstein') }}</option>
            <option value="LT">{{ _('Lithuania') }}</option>
            <option value="LU">{{ _('Luxembourg') }}</option>
            <option value="MO">{{ _('Macau') }}</option>
            <option value="MK">{{ _('Macedonia') }}</option>
            <option value="MG">{{ _('Madagascar') }}</option>
            <option value="MW">{{ _('Malawi') }}</option>
            <option value="MY">{{ _('Malaysia') }}</option>
            <option value="MV">{{ _('Maldives') }}</option>
            <option value="ML">{{ _('Mali') }}</option>
            <option value="MT">{{ _('Malta') }}</option>
            <option value="MH">{{ _('Marshall Islands') }}</option>
            <option value="MQ">{{ _('Martinique') }}</option>
            <option value="MR">{{ _('Mauritania') }}</option>
            <option value="MU">{{ _('Mauritius') }}</option>
            <option value="YT">{{ _('Mayotte') }}</option>
            <option value="MX">{{ _('Mexico') }}</option>
            <option value="FM">{{ _('Micronesia') }}</option>
            <option value="MD">{{ _('Moldova, Republic of') }}</option>
            <option value="MC">{{ _('Monaco') }}</option>
            <option value="MN">{{ _('Mongolia') }}</option>
            <option value="ME">{{ _('Montenegro') }}</option>
            <option value="MS">{{ _('Montserrat') }}</option>
            <option value="MA">{{ _('Morocco') }}</option>
            <option value="MZ">{{ _('Mozambique') }}</option>
            <option value="MM">{{ _('Myanmar') }}</option>
            <option value="NA">{{ _('Namibia') }}</option>
            <option value="NR">{{ _('Nauru') }}</option>
            <option value="NP">{{ _('Nepal') }}</option>
            <option value="NL">{{ _('Netherlands') }}</option>
            <option value="AN">{{ _('Netherlands Antilles') }}</option>
            <option value="NC">{{ _('New Caledonia') }}</option>
            <option value="NZ">{{ _('New Zealand') }}</option>
            <option value="NI">{{ _('Nicaragua') }}</option>
            <option value="NE">{{ _('Niger') }}</option>
            <option value="NG">{{ _('Nigeria') }}</option>
            <option value="NU">{{ _('Niue') }}</option>
            <option value="NF">{{ _('Norfolk Island') }}</option>
            <option value="MP">{{ _('Northern Mariana Islands') }}</option>
            <option value="NO">{{ _('Norway') }}</option>
            <option value="OM">{{ _('Oman') }}</option>
            <option value="PK">{{ _('Pakistan') }}</option>
            <option value="PW">{{ _('Palau') }}</option>
            <option value="PA">{{ _('Panama') }}</option>
            <option value="PG">{{ _('Papua New Guinea') }}</option>
            <option value="PY">{{ _('Paraguay') }}</option>
            <option value="PE">{{ _('Peru') }}</option>
            <option value="PH">{{ _('Philippines') }}</option>
            <option value="PN">{{ _('Pitcairn Island') }}</option>
            <option value="PL">{{ _('Poland') }}</option>
            <option value="PT">{{ _('Portugal') }}</option>
            <option value="PR">{{ _('Puerto Rico') }}</option>
            <option value="QA">{{ _('Qatar') }}</option>
            <option value="RE">{{ _('Reunion') }}</option>
            <option value="RO">{{ _('Romania') }}</option>
            <option value="RU">{{ _('Russian Federation') }}</option>
            <option value="RW">{{ _('Rwanda') }}</option>
            <option value="KN">{{ _('Saint Kitts and Nevis') }}</option>
            <option value="LC">{{ _('Saint Lucia') }}</option>
            <option value="VC">{{ _('Saint Vincent and the Grenadines') }}</option>
            <option value="WS">{{ _('Samoa') }}</option>
            <option value="SM">{{ _('San Marino') }}</option>
            <option value="ST">{{ _('Sao Tome and Principe') }}</option>
            <option value="SA">{{ _('Saudi Arabia') }}</option>
            <option value="SN">{{ _('Senegal') }}</option>
            <option value="RS">{{ _('Serbia') }}</option>
            <option value="SC">{{ _('Seychelles') }}</option>
            <option value="SL">{{ _('Sierra Leone') }}</option>
            <option value="SG">{{ _('Singapore') }}</option>
            <option value="SK">{{ _('Slovakia') }}</option>
            <option value="SI">{{ _('Slovenia') }}</option>
            <option value="SB">{{ _('Solomon Islands') }}</option>
            <option value="SO">{{ _('Somalia') }}</option>
            <option value="ZA">{{ _('South Africa') }}</option>
            <option value="ES">{{ _('Spain') }}</option>
            <option value="LK">{{ _('Sri Lanka') }}</option>
            <option value="SH">{{ _('St. Helena') }}</option>
            <option value="PM">{{ _('St. Pierre and Miquelon') }}</option>
            <option value="SD">{{ _('Sudan') }}</option>
            <option value="SR">{{ _('Suriname') }}</option>
            <option value="SZ">{{ _('Swaziland') }}</option>
            <option value="SE">{{ _('Sweden') }}</option>
            <option value="CH">{{ _('Switzerland') }}</option>
            <option value="SY">{{ _('Syria') }}</option>
            <option value="TW">{{ _('Taiwan') }}</option>
            <option value="TJ">{{ _('Tajikistan') }}</option>
            <option value="TZ">{{ _('Tanzania') }}</option>
            <option value="TH">{{ _('Thailand') }}</option>
            <option value="TG">{{ _('Togo') }}</option>
            <option value="TK">{{ _('Tokelau') }}</option>
            <option value="TO">{{ _('Tonga') }}</option>
            <option value="TT">{{ _('Trinidad and Tobago') }}</option>
            <option value="TN">{{ _('Tunisia') }}</option>
            <option value="TR">{{ _('Turkey') }}</option>
            <option value="TM">{{ _('Turkmenistan') }}</option>
            <option value="TC">{{ _('Turks and Caicos Islands') }}</option>
            <option value="TV">{{ _('Tuvalu') }}</option>
            <option value="UG">{{ _('Uganda') }}</option>
            <option value="UA">{{ _('Ukraine') }}</option>
            <option value="AE">{{ _('United Arab Emirates') }}</option>
            <option value="GB">{{ _('United Kingdom') }}</option>
            <option value="US" selected="selected">{{ _('United States') }}</option>
            <option value="UY">{{ _('Uruguay') }}</option>
            <option value="UZ">{{ _('Uzbekistan') }}</option>
            <option value="VU">{{ _('Vanuatu') }}</option>
            <option value="VE">{{ _('Venezuela') }}</option>
            <option value="VN">{{ _('Viet Nam') }}</option>
            <option value="VI">{{ _('Virgin Islands (U.S.)') }}</option>
            <option value="WF">{{ _('Wallis and Futuna Islands') }}</option>
            <option value="EH">{{ _('Western Sahara') }}</option>
            <option value="YE">{{ _('Yemen') }}</option>
            <option value="ZM">{{ _('Zambia') }}</option>
            <option value="ZW">{{ _('Zimbabwe') }}</option>
          </select>
        </div>

        <div class="field field-privacy">
          <label for="id_privacy" class="privacy-check-label">
            <input required aria-required="true" type="checkbox" name="custom-314" id="id_privacy" />
            <span class="title">{{ _('I’m okay with you handling this info as you explain in your <a href="%s">Privacy Policy</a>')|format('/en-US/privacy-policy') }}</span>
          </label>
        </div>
      </div>
    </div>

    <div class="form-submit">
      <input type="submit" id="footer_email_submit" value="{{ _('Sign me up') }} »" class="button">
      <p class="form-details"><small>{{ _('We will only send you Mozilla-related information.') }}</small></p>
    </div>
  </form>
</aside>
{% endmacro %}


{% macro facebook_share_url(url) -%}
  {{ 'https://www.facebook.com/sharer/sharer.php?u=%s'|format(url|urlencode)|e }}
{%- endmacro %}

{% macro twitter_share_url(url, tweet_text) -%}
  {{ 'https://www.twitter.com/intent/tweet?url=%s&text=%s'|format(url|urlencode, tweet_text|urlencode)|e }}
{%- endmacro %}
